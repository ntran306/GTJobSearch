{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block nav_profile %}active{% endblock %}

{% block content %}
<div class="container profile-page">

  <!-- Profile Header -->
  <section class="profile-card profile-header">
    <div class="profile-avatar">
      <div class="avatar-placeholder">
        <i class="fas fa-user"></i>
      </div>
      <button class="btn btn-outline btn-sm">Upload Photo</button>
    </div>

    <div class="profile-info">
      <h1 class="profile-name">{{ user.username }}</h1>
      <p class="bio">
        {% if profile_type == "jobseeker" and profile.headline %}
          {{ profile.headline }}
        {% elif profile_type == "recruiter" %}
          Recruiter at {{ profile.company }}
        {% else %}
          Add a short description about yourself!
        {% endif %}
      </p>
      <p class="text-sm text-gray-600">
        <i class="fas fa-envelope"></i> {{ user.email }}
      </p>
      <p class="text-sm text-gray-600">
        <i class="fas fa-calendar-alt"></i> Member since {{ user.date_joined|date:"F Y" }}
      </p>
      <a href="{% if profile_type == 'recruiter' %}
                {% url 'accounts:edit_recruiter_profile' %}
              {% else %}
                {% url 'accounts:edit_profile' %}
              {% endif %}" 
        class="btn btn-primary btn-sm">
        Edit Profile
      </a>


    </div>
  </section>

  <!-- Jobseeker-specific sections -->
  {% if profile_type == "jobseeker" %}
    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-tools"></i> Skills</h2>
      </div>
      <div class="section-content skills-display">
        {% if profile.skills %}
          {% for skill in profile.skills|split:"," %}
           <span class="skill-tag">{{ skill }}</span>
          {% endfor %}
        {% else %}
          <p>No skills added yet.</p>
        {% endif %}
      </div>
    </section>

    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-graduation-cap"></i> Education</h2>
      </div>
      <div class="section-content">
        <p>{{ profile.education|linebreaks|default:"No education listed." }}</p>
      </div>
    </section>

    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-briefcase"></i> Work Experience</h2>
      </div>
      <div class="section-content">
        <p>{{ profile.work_experience|linebreaks|default:"No work experience added." }}</p>
      </div>
    </section>

    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-link"></i> Links</h2>
      </div>
      <div class="section-content">
        {% if profile.links %}
          <a href="{{ profile.links }}" target="_blank" class="profile-link">
            <i class="fas fa-external-link-alt"></i> {{ profile.links }}
          </a>
        {% else %}
          <p>No links provided</p>
        {% endif %}
      </div>
    </section>

    <!-- Privacy Settings -->
  <section class="card profile-section">
    <div class="section-header">
      <h2><i class="fas fa-user-shield"></i> Privacy Settings</h2>
    </div>
    <div class="section-content">
      <form method="post" action="{% url 'accounts:profile' %}">
        {% csrf_token %}

        <div class="privacy-option">
          <label>
            <input type="radio" name="privacy" value="public"
                   {% if profile.privacy == "public" %}checked{% endif %}>
            <strong>Public</strong><br>
            <span class="text-sm text-gray-600">
              You'll be visible to all employers and other job seekers being able to receive messages from everyone.
            </span>
          </label>
        </div>

        <div class="privacy-option" style="margin-top: 1rem;">
          <label>
            <input type="radio" name="privacy" value="employers"
                   {% if profile.privacy == "employers" %}checked{% endif %}>
            <strong>Employers</strong><br>
            <span class="text-sm text-gray-600">
              Your profile will be visible to employers.  
              You may receive messages about potential job opportunities.
            </span>
          </label>
        </div>

        <div class="privacy-option" style="margin-top: 1rem;">
          <label>
            <input type="radio" name="privacy" value="private"
                   {% if profile.privacy == "private" %}checked{% endif %}>
            <strong>Private</strong><br>
            <span class="text-sm text-gray-600">
              You'll be able to apply for jobs but won't get contacted by employers.  
              When you check in with an employer during a career fair, they'll see your basic info and can message you.
            </span>
          </label>
        </div>

        <button type="submit" class="btn btn-primary btn-sm" style="margin-top: 1rem;">
          Save Privacy Settings
        </button>
      </form>
    </div>
  </section>

    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-bookmark"></i> Saved Jobs</h2>
      </div>
      <div class="section-content">
        {% if saved_jobs %}
          <ul>
            {% for job in saved_jobs %}
              <li>{{ job.title }} at {{ job.company }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <p>You havenâ€™t saved any jobs yet.</p>
        {% endif %}
      </div>
    </section>
  {% endif %}

  <!-- Recruiter-specific sections -->
  {% if profile_type == "recruiter" %}
    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-id-card"></i> Company/Recruiter Name</h2>
      </div>
      <div class="section-content">
        <p>{{ profile.name }}</p>
      </div>
    </section>

    <section class="card profile-section">
      <div class="section-header">
        <h2><i class="fas fa-rocket"></i> Quick Actions</h2>
      </div>
      <div class="section-content action-buttons">
        <a href="{% url 'jobs:create_job' %}" class="action-btn"><i class="fas fa-plus"></i> Post Job</a>
        <a href="{% url 'candidates:search_candidates' %}">Browse Candidates</a>
      </div>
    </section>
  {% endif %}

</div>
{% endblock %}
